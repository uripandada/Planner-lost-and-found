import { Injectable } from '@angular/core';
import { Resolve, ActivatedRouteSnapshot } from '@angular/router';
import { Observable, of } from 'rxjs';
import { HotelItemData, HotelClient, GetListOfHotelsQuery } from '../autogenerated-clients/api-client';
import { map } from 'rxjs/operators';
import { HotelService } from '../services/hotel.service';

@Injectable({ providedIn: 'root' })
export class HotelListResolver implements Resolve<Observable<Array<HotelItemData>>> {
  constructor(private hotelClient: HotelClient, private hotelService: HotelService) { }

  resolve(routeSnapshot: ActivatedRouteSnapshot) {
    return this.hotelClient.getList(new GetListOfHotelsQuery({})).pipe(
      map(hotels => {
        this.hotelService.setHotels(hotels);

        return [];
      })
    );
  }
}
